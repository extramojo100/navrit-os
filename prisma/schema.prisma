generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Node {
  id        String  @id @default(uuid())
  type      String
  name      String
  parentId  String?
  rules     Rule[]
}

model Rule {
  id        String @id @default(uuid())
  nodeId    String
  node      Node   @relation(fields: [nodeId], references: [id])
  category  String
  key       String
  value     String
  priority  Int
}

model Lead {
  id             String    @id @default(uuid())
  name           String
  phone          String
  status         String
  temperature    String
  commissionEst  Float
  journeys       Journey[]
  createdAt      DateTime  @default(now())
}

model Journey {
  id             String   @id @default(uuid())
  leadId         String
  lead           Lead     @relation(fields: [leadId], references: [id])
  type           String   // NEW_SALE, TITLE_TRANSFER, UCRF
  model          String
  stage          String
  
  // Financials
  exShowroom     Float
  discounts      Json
  insurance      Float
  accessories    Float
  netPrice       Float
  
  // Relations
  titleTransfer  TitleTransfer?
  refinance      Refinance?
  
  stockStatus    String
  workflowStep   Int
}

model TitleTransfer {
  id          String  @id @default(uuid())
  journeyId   String  @unique
  journey     Journey @relation(fields: [journeyId], references: [id])
  currentStep Int
  isBreached  Boolean @default(false)
  agentId     String?
}

model Refinance {
  id            String  @id @default(uuid())
  journeyId     String  @unique
  journey       Journey @relation(fields: [journeyId], references: [id])
  loanAmount    Float
  financier     String
  baseIncentive Float
  topUp         Float
  taxDeduction  Float
}
